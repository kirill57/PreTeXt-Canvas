<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PreTeXt Canvas - WYSIWYG Editor</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header with toolbar -->
        <header class="header">
            <div class="toolbar">
                <div class="logo">
                    <h1>PreTeXt Canvas</h1>
                </div>
                <div class="file-controls">
                    <button id="new-doc" class="btn btn-primary">New</button>
                    <button id="open-file" class="btn btn-secondary">Open</button>
                    <button id="save-file" class="btn btn-secondary">Save</button>
                    <input type="file" id="file-input" accept=".ptx,.xml" style="display: none;">
                </div>
                <div class="edit-controls">
                    <button id="undo-action" class="btn btn-secondary" title="Undo (Ctrl+Z)">Undo</button>
                    <button id="redo-action" class="btn btn-secondary" title="Redo (Ctrl+Y or Ctrl+Shift+Z)">Redo</button>
                </div>
                <div class="view-controls">
                    <button id="visual-view" class="btn btn-view active">Visual</button>
                    <button id="source-view" class="btn btn-view">Source</button>
                    <button id="split-view" class="btn btn-view">Split</button>
                </div>
                <div class="layout-controls">
                    <button id="toggle-left-sidebar" class="btn btn-secondary" aria-expanded="true">Hide Left</button>
                    <button id="toggle-right-sidebar" class="btn btn-secondary" aria-expanded="true">Hide Right</button>
                </div>
            </div>
        </header>

        <!-- Main content area -->
        <main class="main-content">
            <!-- Left sidebar - Element palette and outline -->
            <aside class="left-sidebar" id="left-sidebar">
                <div class="panel-tabs">
                    <button class="tab-btn active" data-panel="palette">Elements</button>
                    <button class="tab-btn" data-panel="outline">Outline</button>
                </div>
                
                <!-- Element Palette -->
                <div id="palette-panel" class="panel active">
                    <h3>PreTeXt Elements</h3>
                    <div id="palette-container" class="element-groups" aria-live="polite">
                        <!-- Palette elements are rendered dynamically by script.js -->
                    </div>
                </div>

                <!-- Document Outline -->
                <div id="outline-panel" class="panel">
                    <h3>Document Outline</h3>
                    <div id="outline-tree" class="outline-tree">
                        <!-- Dynamic outline will be generated here -->
                    </div>
                </div>
            </aside>

            <div class="sidebar-resizer left-resizer" data-side="left" title="Drag to resize"></div>

            <!-- Editor area -->
            <div class="editor-container">
                <!-- Visual Editor -->
                <div id="visual-editor" class="editor-pane active">
                    <div id="visual-content" class="visual-content" contenteditable="true">
                        <div class="pretext-document">
                            <h1>Welcome to PreTeXt Canvas</h1>
                            <p>Start creating your PreTeXt document here. Use the element palette on the left to add new elements, or type directly in this visual editor.</p>
                        </div>
                    </div>
                </div>

                <!-- Source Editor -->
                <div id="source-editor" class="editor-pane">
                    <textarea id="source-content" class="source-content" spellcheck="false"><?xml version="1.0" encoding="UTF-8"?>
<pretext xmlns:xi="http://www.w3.org/2001/XInclude" xml:lang="en-US">
    <docinfo>
        <macros>
        \newcommand{\R}{\mathbb R}
        </macros>
    </docinfo>
    
    <book xml:id="sample-book">
        <title>Welcome to PreTeXt Canvas</title>
        
        <chapter xml:id="ch-introduction">
            <title>Introduction</title>
            
            <section xml:id="sec-getting-started">
                <title>Getting Started</title>
                
                <p>
                    Start creating your PreTeXt document here. Use the element palette on the left to add new elements, or edit the XML source directly.
                </p>
                
            </section>
        </chapter>
    </book>
</pretext></textarea>
                </div>
            </div>

            <div class="sidebar-resizer right-resizer" data-side="right" title="Drag to resize"></div>

            <!-- Right sidebar - Properties panel -->
            <aside class="right-sidebar" id="right-sidebar">
                <div class="panel">
                    <h3>Properties</h3>
                    <div id="properties-content" class="properties-content" role="region" aria-live="polite" aria-busy="false">
                        <p class="no-selection">Select an element to view its properties</p>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>Validation</h3>
                    <div id="validation-content" class="validation-content">
                        <div class="validation-status valid">
                            <span class="status-icon">✓</span>
                            <span>Document is valid</span>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Status bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="document-status">Ready</span>
            </div>
            <div class="status-right">
                <span id="cursor-position">Line 1, Column 1</span>
            </div>
        </footer>
    </div>

    <!-- Template chooser modal -->
    <div id="template-modal" class="template-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="template-modal-title">
        <div class="template-modal__backdrop" data-template-modal-dismiss></div>
        <div class="template-modal__dialog">
            <header class="template-modal__header">
                <h2 id="template-modal-title" class="template-modal__title">Create a new document</h2>
                <p class="template-modal__subtitle">Select a starting template to load into the visual and source editors.</p>
                <button type="button" class="template-modal__close" data-template-modal-dismiss aria-label="Close template chooser">×</button>
            </header>
            <div class="template-modal__body">
                <div id="template-option-list" class="template-modal__list" role="listbox" aria-labelledby="template-modal-title">
                    <!-- Template cards rendered dynamically -->
                </div>
                <div class="template-modal__preview" id="template-preview" aria-live="polite">
                    <h3 id="template-preview-title" class="template-preview__title">Select a template</h3>
                    <p id="template-preview-description" class="template-preview__description">Template details and a snippet preview will appear here.</p>
                    <pre id="template-preview-code" class="template-preview__code"><code></code></pre>
                </div>
            </div>
            <footer class="template-modal__footer">
                <button type="button" class="btn btn-secondary" id="template-cancel">Cancel</button>
                <button type="button" class="btn btn-primary" id="template-apply" disabled>Use template</button>
            </footer>
        </div>
    </div>

    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                tags: 'ams'
            },
            chtml: {
                scale: 1.0,
                minScale: .5,
                matchFontHeight: false
            }
        };
    </script>

    <script src="templates.js"></script>
    <script src="script.js"></script>
</body>
</html>
